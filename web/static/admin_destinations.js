// Code generated by tsgo. DO NOT EDIT.

//
// See the file COPYRIGHT for copyright information.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
"use strict";
import * as ims from "./ims.js";
//
// Initialize UI
//
initAdminDestinationsPage();
async function initAdminDestinationsPage() {
    const initResult = await ims.commonPageInit();
    if (!initResult.authInfo.authenticated) {
        await ims.redirectToLogin();
        return;
    }
    window.loadDestinations = loadDestinations;
    const form = document.getElementById("destination-form");
    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        await submit();
    });
}
function parseDestinations(artDataEl, campDataEl, otherDataEl) {
    const destinations = {
        art: [],
        camp: [],
        other: [],
    };
    {
        const artExtDatas = JSON.parse(artDataEl.value);
        for (const ed of artExtDatas) {
            destinations.art.push({
                name: ed.name,
                location_string: ed.location_string,
                external_data: ed,
            });
        }
    }
    {
        const campExtDatas = JSON.parse(campDataEl.value);
        for (const ed of campExtDatas) {
            destinations.camp.push({
                name: ed.name,
                location_string: ed.location_string,
                external_data: ed,
            });
        }
    }
    {
        const otherExtDatas = JSON.parse(otherDataEl.value);
        for (const ed of otherExtDatas) {
            destinations.other.push({
                name: ed.name,
                location_string: ed.location_string,
                external_data: ed,
            });
        }
    }
    return destinations;
}
async function submit() {
    ims.clearErrorMessage();
    const artDataEl = document.getElementById("art-data");
    const campDataEl = document.getElementById("camp-data");
    const otherDataEl = document.getElementById("other-data");
    let destinations = null;
    try {
        destinations = parseDestinations(artDataEl, campDataEl, otherDataEl);
    }
    catch (e) {
        console.log(e);
        ims.setErrorMessage(e);
        return;
    }
    const eventName = document.getElementById("event-name").value;
    const { err } = await ims.fetchNoThrow(url_destinations.replace("<event_id>", eventName), {
        body: JSON.stringify(destinations),
    });
    if (err != null) {
        const message = `Failed to create destination: ${err}`;
        console.log(message);
        ims.setErrorMessage(message);
        ims.controlHasError(artDataEl);
        ims.controlHasError(campDataEl);
        ims.controlHasError(otherDataEl);
        return;
    }
    ims.controlHasSuccess(artDataEl);
    ims.controlHasSuccess(campDataEl);
    ims.controlHasSuccess(otherDataEl);
}
async function loadDestinations() {
    ims.clearErrorMessage();
    const eventName = document.getElementById("event-name").value;
    const { json, err } = await ims.fetchNoThrow(url_destinations.replace("<event_id>", eventName), {
        headers: { "Cache-Control": "no-cache" },
    });
    if (err != null || json == null) {
        const message = `Failed to load destinations: ${err}`;
        console.error(message);
        ims.setErrorMessage(message);
        return;
    }
    {
        const arts = [];
        for (const ed of json.art ?? []) {
            arts.push(ed.external_data);
        }
        document.getElementById("art-data").value = JSON.stringify(arts, null, 2);
        document.getElementById("art-data-label").textContent = `JSON Data (${arts.length})`;
    }
    {
        const camps = [];
        for (const ed of json.camp ?? []) {
            camps.push(ed.external_data);
        }
        document.getElementById("camp-data").value = JSON.stringify(camps, null, 2);
        document.getElementById("camp-data-label").textContent = `JSON Data (${camps.length})`;
    }
    {
        const others = [];
        for (const ed of json.other ?? []) {
            others.push(ed.external_data);
        }
        document.getElementById("other-data").value = JSON.stringify(others, null, 2);
        document.getElementById("other-data-label").textContent = `JSON Data (${others.length})`;
    }
}
