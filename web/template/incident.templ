//
// See the file COPYRIGHT for copyright information.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

package template

templ Incident(deployment, versionName, versionRef, eventName string) {
<!DOCTYPE html>
<html lang="en">
@Head("Incident Details | " + eventName, "incident.js", true, versionRef)

<body>
<div class="container-fluid">
@Header(deployment)
@Nav(eventName)

@LoadingOverlay()

@ErrorInfo()

    <!-- Help modal for incident page -->
    <div class="modal no-print" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <p class="modal-title fs-5" id="helpModalLabel">Keyboard shortcuts</p>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" />
          </div>
          <div class="modal-body">
            <code>n</code>: create (n)ew Incident <br/>
            <code>a</code>: jump to (a)dd new report text<br/>
            <code>h</code>: toggle showing system-generated (h)istory <br/>
          </div>
        </div>
      </div>
    </div>

    <!-- Incident type info -->
    <div class="modal no-print" id="incidentTypeInfoModal" tabindex="-1" aria-labelledby="incidentTypeInfoModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <p class="modal-title fs-5" id="incidentTypeInfoModalLabel">Incident Types</p>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" />
          </div>
          <div class="modal-body">
            <ul id="incident-type-info" class="list-group list-group-small" style="white-space: pre-wrap;">
              <template id="incident-type-info-template">
                <li class="list-group-item">
                  <div class="type-name"></div>
                  <div class="type-description ms-3 text-body-secondary"></div>
                </li>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Incident number, state, started -->

    <div class="row py-1">
      <div class="col-sm-2 py-1">
        <div class="input-group flex-nowrap">
          <label for="incident_number" class="control-label input-group-text">IMS #</label>
          <input id="incident_number" type="text" class="form-control form-control-static mw-4rem" readonly/>
        </div>
      </div>
      <div class="col-sm-4 py-1">
        <div class="input-group">
          <label for="incident_state" class="control-label input-group-text">State</label>
          <select
                  id="incident_state"
                  class="form-control form-select form-select-sm auto-width"
                  onchange="editState()"
          >
            <option value="new">New</option>
            <option value="on_hold">On Hold</option>
            <option value="dispatched">Dispatched</option>
            <option value="on_scene">On Scene</option>
            <option value="closed">Closed</option>
          </select>
        </div>
      </div>
      <div class="col-sm-6 py-1">
        <div class="input-group">
          <!-- This label will be applied to the altInput, which is created in the JS by Flatpickr. -->
          <label class="control-label input-group-text" for="alt_started_datetime">Started</label>
          <input id="started_datetime" type="text" class="form-control" />
          <span id="started_datetime_tz" class="control-follow-text input-group-text"
              title="This datetime must be edited in your computer's local time zone."
          ></span>
        </div>
      </div>
    </div>

    <!-- Summary -->

    <div class="row">
      <div class="input-group">
        <label for="incident_summary" class="input-group-text control-label">Summary</label>
        <input
                id="incident_summary" class="form-control form-control-sm"
                type="text" inputmode="latin-prose" autocomplete="off"
                onchange="editIncidentSummary()"
        />
      </div>
    </div>

    <!-- Attached Rangers, incident types -->

    <div class="row">
      <div class="col-sm-6 py-2">
        <div class="card">
          <label class="control-label card-header">
          Rangers
          <a href="https://ranger-clubhouse.burningman.org/reports/on-duty" target="_blank" class="link-body-emphasis float-end no-print" title="On-Duty Report" tabindex="-1">
            On-Duty
            <svg fill="currentColor" class="bi">
              <use href="#box-arrow-up-right"></use>
            </svg>
          </a>
          </label>
          <ul id="incident_rangers_list" class="list-group list-group-flush list-group-small card-body">
            <template id="incident_rangers_li_template">
              <li class="list-group-item flex-input-container ps-3 hidden">
                <span><a href="#" tabindex="-1"></a></span>
                <input aria-label="Description of Ranger role" type="text" class="form-control form-control-sm short-input auto-width hover-placeholder border-0"
                    placeholder="Short description of role" onchange="setRangerRole(this)" maxlength="50"
                />
                <button class="badge btn btn-danger remove-badge float-end" onclick="removeRanger(this)" tabindex="-1">
                  X
                </button>
              </li>
            </template>
          </ul>
          <div class="flex-input-container card-footer no-print">
            <label for="ranger_add" class="control-label">Add:</label>
            <input
                    type="text"
                    id="ranger_add"
                    aria-label="Add Ranger Handle"
                    list="ranger_handles"
                    autocomplete="off"
                    class="form-control form-control-sm auto-width"
                    onchange="addRanger()"
            />
            <datalist id="ranger_handles">
              <option value=""></option>
            </datalist>
          </div>
        </div>
      </div>
      <div class="col-sm-6 py-2">
        <div class="card">
          <label class="control-label card-header">Incident Types
            <a href="#" class="link-body-emphasis float-end no-print" id="show-incident-type-info" title="Show Incident Type descriptions" tabindex="-1">
              Info
              <svg fill="currentColor" class="bi">
                <use href="#question-circle" />
              </svg>
            </a>
          </label>
          <ul id="incident_types_list" class="list-group list-group-flush list-group-small card-body">
            <template id="incident_types_li_template">
              <li class="list-group-item ps-3 hidden">
                <button class="badge btn btn-danger remove-badge float-end" onclick="removeIncidentType(this)">
                  X
                </button>
              </li>
            </template>
          </ul>
          <div class="card-footer flex-input-container no-print">
            <label for="incident_type_add" class="control-label">Add:</label>
            <input
                    type="text"
                    id="incident_type_add"
                    aria-label="Add Incident Type"
                    list="incident_types"
                    autocomplete="off"
                    class="form-control form-control-sm auto-width"
                    onchange="addIncidentType()"
            />
            <datalist id="incident_types">
              <option value=""/>
            </datalist>
          </div>
        </div>
      </div>
    </div>

    <!-- Location -->

    <div class="row py-1">
      <div class="col-sm-12">
        <div class="card">
          <label class="control-label card-header">Location
            <a href="../destinations" target="_blank" class="link-body-emphasis float-end no-print" title="On-Duty Report" tabindex="-1">
              Destinations
              <svg fill="currentColor" class="bi">
                <use href="#box-arrow-up-right"></use>
              </svg>
            </a>
          </label>
          <div class="card-body">
            <form class="form-horizontal">
              <div class="input-group row align-items-center">
                <label for="incident_location_name"
                       class="col-sm-2 col-form-label control-label">Name:</label>
                <div class="col-sm-10">
                  <input
                          id="incident_location_name" class="form-control form-control-sm"
                          type="text" inputmode="latin-prose" autocomplete="off"
                          placeholder="Name of location"
                          list="destinations-list"
                          aria-label="Location name"
                          onchange="editLocationName()"
                  />
                  <datalist id="destinations-list"></datalist>
                </div>
              </div>
              <div class="input-group row align-items-center">
                <label for="incident_location_address"
                       class="col-sm-2 col-form-label control-label">Address:</label>
                <div class="col-sm-10">
                  <input
                          id="incident_location_address" class="form-control form-control-sm"
                          type="text" inputmode="latin-prose" autocomplete="off"
                          placeholder="Address of location"
                          aria-label="Location address"
                          onchange="editLocationAddress();"
                  />
                </div>
              </div>
              <div class="input-group row align-items-center">
                <label for="incident_location_description" class="col-sm-2 col-form-label control-label">Details:</label>
                <div class="col-sm-10">
                  <input
                          id="incident_location_description" class="form-control form-control-sm"
                          type="text" inputmode="latin-prose" autocomplete="off"
                          aria-label="Additional location description"
                          placeholder="Other identifying info"
                          onchange="editLocationDescription()"
                  />
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Attached field reports, linked incidents -->

    <div class="row py-2">
      <div class="col-sm-6">
        <div class="card">
          <label class="control-label card-header">Attached Field Reports/Stays</label>
          <ul id="attached_field_reports" class="list-group list-group-small card-body list-group-flush">
            <template id="attached_field_report_li_template">
              <li class="list-group-item ps-3 hidden">
                <button class="badge btn btn-danger remove-badge float-end"
                        onclick="detachFieldReport(this)">
                  X
                </button>
              </li>
            </template>
          </ul>
          <div id="attached_field_report_add_container" class="flex-input-container card-footer no-print">
            <label for="attached_field_report_add" class="control-label">Add:</label>
            <select
                    id="attached_field_report_add"
                    class="form-control form-control-sm"
                    onchange="attachFieldReport()"
            >
              <option value=""/>
            </select>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card">
          <label class="control-label card-header">Linked Incidents</label>
          <ul id="linked_incidents" class="list-group list-group-small card-body list-group-flush">
            <li class="list-group-item ps-3 hidden">
              <button class="badge btn btn-danger remove-badge float-end"
                      onclick="unlinkIncident(this)">
                  X
              </button>
            </li>
          </ul>
          <div id="linked_incident_add_container" class="flex-input-container card-footer no-print">
            <label class="control-label" for="linked_incident_add">Link IMS #:</label>
            <input
                    id="linked_incident_add"
                    class="form-control form-control-sm"
                    onchange="linkIncident(this)"
                    autocomplete="off"
                    placeholder="1 or 3,4,5 or 2015#2"
                    type="text"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Incident details -->

    <div class="row">
      <div class="col-sm-12">
        <div class="card">
          <label class="control-label card-header">Entries from Incident and attached Field Reports/Stays</label>
          <div id="report_entry_well" class="card-body">
            <label class="control-label">
              <input id="history_checkbox" type="checkbox" onchange="toggleShowHistory()"/>
              Show history and stricken
            </label>
            <div id="report_entries"></div>
          </div>
          <div class="card-footer">
            <textarea
                    id="report_entry_add"
                    aria-label="New report entry text"
                    class="form-control no-print"
                    placeholder="Press &quot;a&quot; to add report text"
                    onchange="reportEntryEdited()"
            ></textarea>
            <div class="d-flex justify-content-between">
              <button
                      id="report_entry_submit"
                      aria-label="Submit report entry"
                      type="submit"
                      class="btn btn-default btn-sm btn-block my-1 disabled no-print float-start"
                      onclick="submitReportEntry()"
              >
                Add Entry (Control ‚èé)
              </button>
              <!-- File attachment -->
              <label class="input-group-text hidden" for="attach_file_input">Attach file</label>
              <input type="file" class="form-control hidden" id="attach_file_input" name="filename" onchange="attachFile();" />
              <input
                      id="attach_file"
                      type="button"
                      class="btn btn-default btn-sm btn-block btn-secondary my-1 form-control-lite no-print hidden"
                      value="Attach file"
                      onclick="document.getElementById('attach_file_input').click();"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

@Footer(versionName, versionRef)
</div>
</body>
</html>
}
